<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Citadel Scholarship</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <nav class="site-nav">
      <a href="index.html" class="active">오늘</a>
      <a href="study-history.html">POW 기록</a>
      <a href="donation-history.html">기부 기록</a>
    </nav>
    <header class="hero">
      <div class="hero-top">
        <div class="hero-brand">
          <p class="hero-brand-title">CITADEL SCHOLARSHIP</p>
          <p class="hero-brand-subtitle">Proof of Work:Life of Satoshi</p>
        </div>
        <div class="hero-login" id="discord-card">
          <div class="row hero-login-actions">
            <button id="discord-app-login" class="primary">App Login</button>
            <button id="discord-web-login" class="hidden">Web Login</button>
          </div>
          <div class="profile" id="discord-profile">
            <div class="profile-body">
              <img id="discord-avatar" alt="Discord avatar" />
              <div>
                <p class="profile-name" id="discord-username">로그인된 사용자 없음</p>
                <p class="profile-meta" id="discord-guild">서버: -</p>
              </div>
            </div>
            <div class="row profile-actions">
              <button id="discord-refresh" class="ghost">역할 재확인</button>
              <button id="discord-logout" class="ghost">로그아웃</button>
            </div>
          </div>
          <p class="hint" id="discord-hint">
            역할(Role) 권한은 Discord OAuth 콜백에서 확인됩니다.
          </p>
        </div>
      </div>
    </header>

    <main class="locked">
      <section class="grid">
        <div class="card">
          <h2>POW 타이머</h2>
          <div class="stack">
            <label>
              POW 시간(단위 : 분)
              <input id="goal-minutes" type="number" min="1" value="120" />
            </label>
            <label>
              오늘의 목표
              <textarea
                id="study-plan"
                rows="3"
                placeholder="예: 스페인어 회화 2과 복습 + 단어 20개 암기"
              ></textarea>
            </label>
            <p class="hint" id="plan-status">목표는 자동 저장됩니다.</p>
            <p class="muted">사토시 기부 기준을 POW 시작 전에 설정하세요.</p>
            <label>
              기부 방식
              <select id="donation-scope">
                <option value="session">회차 별 기부</option>
                <option value="total">누적 후 한번에 기부</option>
              </select>
            </label>
            <label>
              POW 분야 선택
              <select id="donation-mode">
                <option value="pow-writing">✒️ㅣ글쓰기</option>
                <option value="pow-music">🎵ㅣ음악</option>
                <option value="pow-study">📝ㅣ공부</option>
                <option value="pow-art">🎨ㅣ그림</option>
                <option value="pow-reading">📚ㅣ독서</option>
                <option value="pow-service">✝️ㅣ봉사</option>
              </select>
            </label>
            <label>
              목표 달성시 기부금
              <input
                id="sats-rate"
                type="text"
                inputmode="numeric"
                placeholder="예) 10sats"
              />
            </label>
            <div class="row">
              <button id="start" class="primary">시작</button>
            </div>
          </div>
        </div>

        <div class="card" id="study-card">
          <h2>POW 인증 카드 만들기</h2>
          <p class="muted">
            카메라로 촬영하거나, 사진/동영상을 업로드 한 뒤, POW 내용과 시간, 목표 달성율을
            표시한 인증 카드를 생성합니다.
          </p>
          <div class="stack">
            <label>
              오늘의 목표 (수정 가능)
              <textarea id="study-plan-preview" rows="2"></textarea>
            </label>
            <div class="row">
              <button id="open-camera">카메라 열기</button>
              <label class="file">
                업로드
                <input id="media-upload" type="file" accept="image/*,video/*" />
              </label>
              <input
                id="camera-capture"
                type="file"
                accept="image/*,video/*"
                capture="environment"
                class="hidden"
              />
            </div>
            <div class="preview">
              <video id="camera" autoplay playsinline></video>
              <canvas id="snapshot" width="640" height="480"></canvas>
              <img id="photo-preview" alt="업로드 미리보기" />
              <canvas id="badge" width="1080" height="1080"></canvas>
            </div>
            <div class="row">
              <button id="generate" class="primary">인증 카드 생성</button>
            </div>
            <div class="result">
              <a id="download" class="accent" download="citadel_idioma_badge.png">이미지 저장</a>
            </div>
            <label>
              기부 메모 (선택)
              <input id="donation-note" placeholder="예: 누적 POW 2시간 달성" />
            </label>
            <button id="share-discord" class="primary">디스코드에 공유 &amp; 사토시 기부</button>
            <button id="donate" class="primary">기부 기록 저장</button>
            <p class="hint" id="share-status">
              디스코드 공유와 기부 연동은 서버에서 설정해야 합니다.
            </p>
            <p class="hint" id="donation-status">실제 사토시 전송은 LNURL/지갑 연동이 필요합니다.</p>
          </div>
        </div>

        <div class="card" id="today-donation-summary">
          <h2>오늘 기부 현황</h2>
          <p class="muted">선택한 기부 방식에 따라 누적 금액과 적립액을 확인하세요.</p>
          <div class="stack">
            <div class="row">
              <span class="pill">
                지금까지 누적 기부 금액: <strong id="today-total-donated">0 sats</strong>
              </span>
            </div>
            <div class="row hidden" id="today-accumulated-row">
              <span class="pill">
                지급까지 적립액: <strong id="today-accumulated-sats">0 sats</strong>
              </span>
            </div>
            <button id="today-accumulated-pay" class="primary hidden">적립액 기부하기</button>
            <p class="hint" id="today-donation-hint">
              누적 후 한번에 기부를 선택하면 적립액을 한 번에 기부할 수 있습니다.
            </p>
          </div>
        </div>
      </section>
    </main>
    <div id="accumulation-toast" class="toast hidden" role="status" aria-live="polite">
      <span id="accumulation-toast-message"></span>
      <button class="toast-close" type="button" aria-label="닫기">✕</button>
    </div>

    <footer>
      <p>Citadel Scholarship · POW 기록이 장학금으로 이어집니다.</p>
    </footer>

    <div id="wallet-modal" class="wallet-modal hidden" aria-hidden="true">
      <div class="wallet-modal__panel" role="dialog" aria-modal="true">
        <p class="wallet-toast hidden" id="wallet-toast">인보이스가 복사되었습니다.</p>
        <div class="wallet-modal__header">
          <h3>결제할 라이트닝 지갑을 선택하세요</h3>
          <button class="wallet-modal__close" id="wallet-modal-close" aria-label="닫기">
            ✕
          </button>
        </div>
        <div class="wallet-modal__body">
          <div class="wallet-invoice hidden" id="wallet-invoice">
            <p class="wallet-invoice__label">인보이스</p>
            <div class="wallet-invoice__content">
              <img id="wallet-invoice-qr" alt="Lightning invoice QR code" />
            </div>
          </div>
          <button class="wallet-option" data-wallet="walletofsatoshi">Wallet of Satoshi</button>
          <button class="wallet-option" data-wallet="blink">Blink</button>
          <button class="wallet-option" data-wallet="strike">Strike</button>
          <button class="wallet-option" data-wallet="zeus">Zeus</button>
        </div>
        <p class="hint" id="wallet-status">선택한 지갑으로 인보이스를 전달합니다.</p>
      </div>
    </div>

    <div id="timer-modal" class="timer-modal hidden" aria-hidden="true">
      <div class="timer-modal__panel" role="dialog" aria-modal="true">
        <h3>POW 타이머</h3>
        <div class="timer-modal__time" id="timer-display">00:00:00</div>
        <p class="timer-modal__note">
          현재 누적 금액: <strong id="current-total-sats">0 sats</strong>
        </p>
        <div class="row timer-modal__actions">
          <button id="pause" class="ghost">일시정지</button>
          <button id="reset" class="ghost">리셋</button>
          <button id="finish" class="accent">POW 종료</button>
        </div>
      </div>
    </div>

    <script src="app.js"></script>
  </body>
</html>
